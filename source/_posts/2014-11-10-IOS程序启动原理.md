---
layout : page
date: 2014-11-10 15:59:18 +0800
title: IOS程序启动原理
tags: OC
image:
  feature: abstract-11.jpg
commets: true
share: true
---

> 重点 : `模型`, `代理`

θ = {$ W^{IH}, W^{HO}, B^H, B^O $\} 

#1. 项目中的常用文件

- Tests文件用于单元测试
- Supporting files文件夹下`Info.plist`的文件，该文件对工程做一些运行期的配置，非常重要，不能删除
    - Localiztion native development region(CFBundleDevelopmentRegion)-本地化相关
    - Bundle display name(CFBundleDisplayName)-程序安装后显示的名称,限制在10－12个字符，如果超出，将被显示缩写名称
    - Icon file(CFBundleIconFile)-app图标名称,一般为Icon.png
    - Bundle version(CFBundleVersion)-应用程序的版本号，每次往App Store上发布一个新版本时，需要增加这个版本号
    - Main storyboard file base name(NSMainStoryboardFile)-主storyboard文件的名称
    - Bundle identifier(CFBundleIdentifier)-项目的唯一标识，部署到真机时用到
- `.pch`文件，是一个头文件(Xcode6没有找到)
    - pch头文件的内容能被项目中的其他所有源文件共享和访问
    - 一般在pch文件中定义一些全局的宏

<!--more-->


```
#ifdef DEBUG //在调试模式下，才有定义DEBUG,调试阶段
#define Log(...) NSLog(__VA_ARGS__)
#else    //发布阶段
#define Log(...) /* */ 
#endif
```




#2. UIApplicaiton
- UIApplication对象是应用程序的象征
- 每一个应用都有自己的UIApplication对象，而且是`单例模式`
- 通过[UIApplication sharedApplication]可以获得这个单例对象
- 一个iOS程序启动后创建的第一个对象就是UIApplication对象
- 利用UIApplication对象，能进行一些应用级别的操作

**UIApplication的常用属性**

- 设置应用程序图标右上角的红色提醒数字
`@property(nonatomic) NSInteger applicationIconBadgeNumber;`
- 设置联网指示器的可见性
`@property(nonatomic,getter=isNetworkActivityIndicatorVisible) BOOL networkActivityIndicatorVisible;`
- UIApplication有个功能十分强大的openURL:方法
`- (BOOL)openURL:(NSURL*)url;`
- 在iOS7中，默认情况下，状态栏都是由UIViewController管理的，UIViewController实现下列方法就可以轻松管理状态栏的可见性和样式
状态栏的样式
`- (UIStatusBarStyle)preferredStatusBarStyle; `
状态栏的可见性
`- (BOOL)prefersStatusBarHidden; `


> main函数中执行了一个UIApplicationMain这个函数

`int UIApplicationMain(int argc, char *argv[], NSString *principalClassName, NSString *delegateClassName);`

- argc、argv：直接传递给UIApplicationMain进行相关处理即可
- principalClassName：指定应用程序类名（app的象征），该类必须是UIApplication(或子类)。如果为nil,则用UIApplication类作为默认值
- delegateClassName：指定应用程序的代理类，该类必须遵守UIApplicationDelegate协议


UIApplicationMain函数会根据principalClassName创建UIApplication对象，根据delegateClassName创建一个delegate对象，并将该delegate对象赋值给UIApplication对象中的delegate属性

接着会建立应用程序的Main Runloop（事件循环），进行事件的处理(首先会在程序完毕后调用delegate对象的application:didFinishLaunchingWithOptions:方法)

程序正常退出时UIApplicationMain函数才返回


![代理](http://byson.img42.wal8.com/img42/434369_20140909170142/141508798703.png)

#3. UIWindow

- UIWindow是一种特殊的UIView，通常在一个app中只会有一个UIWindow
- iOS程序启动完毕后，创建的`第一个视图控件就是UIWindow`，接着创建控制器的view，最后将控制器的view添加到UIWindow上，于是控制器的view就显示在屏幕上了
- 一个iOS程序之所以能显示到屏幕上，完全是因为它有UIWindow,也就说，``没有UIWindow，就看不见任何UI界面`



```
/**
 *  程序启动完毕就会调用一次
 */
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
    // 1.创建window
    self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];

    // 2.设置window的背景色
    self.window.backgroundColor = [UIColor whiteColor];
    
    MjOneViewController *one = [[MjOneViewController alloc] init];
    // 方法一 :加入到UIWindow   [self.window addSubview:one.view];
    //方法二 推荐
    self.window.rootViewController = one;

    // 3.显示window
    [self.window makeKeyAndVisible];
    return YES;
}
```

> 多界面的切换是通过UIWindow完成的.

#4. 程序启动的完整过程

1.main函数

2.UIApplicationMain
- 创建UIApplication对象
- 创建UIApplication的delegate对象

3.delegate对象开始处理(监听)系统事件(`没有storyboard`)
- 程序启动完毕的时候, 就会调用代理的application:didFinishLaunchingWithOptions:方法
- 在application:didFinishLaunchingWithOptions:中创建UIWindow
- 创建和设置UIWindow的rootViewController
- 显示窗口

3.根据Info.plist获得最主要storyboard的文件名,加载最主要的storyboard(`有storyboard`)
- 创建UIWindow
- 创建和设置UIWindow的rootViewController
- 显示窗口

![图1](http://byson.img42.wal8.com/img42/434369_20140909170142/141508797807.png)

![图2](http://byson.img42.wal8.com/img42/434369_20140909170142/141508797866.jpg)

