<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 理解硬链接和软链接 · Snow Memory | Andrew Liu</title><meta name="description" content="理解硬链接和软链接 - Andrew Liu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://andrewliu.in/atom.xml" title="Snow Memory | Andrew Liu"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/dinosaurliu" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/Andrew-liu" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">理解硬链接和软链接</h1><div class="post-info">Aug 10, 2015</div><div class="post-content"><p>本博客采用创作共用版权协议, 要求署名、非商业用途和保持一致. 转载本博客文章必须也遵循<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" target="_blank" rel="external">署名-非商业用途-保持一致</a>的创作共用协议.</p>
<h1 id="硬链接"><a href="#硬链接" class="headerlink" title="硬链接"></a>硬链接</h1><p>为解决文件的共享使用, Linux系统引入了两种链接: <code>硬链接 (hard link)</code>与<code>软链接（又称为符号链接,即soft link或symbolic link）</code>. 链接为Linux系统解决了文件的共享使用,还带来了隐藏文件路径、增加权限安全及节省存储等好处.</p>
<ul>
<li>若一个inode号对应多个文件名, 则称这些文件为硬链接(硬链接就是同一个文件使用了多个别名), 对文件的修改, 会影响到<code>所有相同inode的硬链接</code>, 删除一个硬链接, 对其他硬链接没有影响</li>
</ul>
<a id="more"></a>
<blockquote>
<p>硬链接可由命令<code>link</code>或<code>ln</code>创建</p>
</blockquote>
<ul>
<li>硬链接只能对已存在的文件创建</li>
<li>有相同的inode号</li>
<li>不能对目录进行创建硬链接</li>
<li>删除其中一个硬链接并不影响其他相同inode文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># 格式: ln 源文件(已存在) 目标硬链接文件名</div><div class="line">$ ln oldfile hardfile</div><div class="line">$ link oldfile linkfile</div><div class="line"></div><div class="line"></div><div class="line"># 查看inode号, 发现inode号相同(是文件的唯一标识, 后面会详细说)</div><div class="line">$ ls -li| grep file</div><div class="line">16134546 -rw-r--r--   3 andrew_liu  staff        25  7  6 16:56 hardfile</div><div class="line">16134546 -rw-r--r--   3 andrew_liu  staff        25  7  6 16:56 linkfile</div><div class="line">16134546 -rw-r--r--   3 andrew_liu  staff        25  7  6 16:56 oldfile</div></pre></td></tr></table></figure>
<h1 id="软链接"><a href="#软链接" class="headerlink" title="软链接"></a>软链接</h1><p>若文件用户数据块中<code>存放的内容是另一文件的路径名</code>, 则该文件就是软连接. 软链接就是一个普通文件, 只是数据块内容有点特殊(路径). 例如文件A是文件B的软链接, 读取文件A, 系统会通过路径访问文件B, 文件A依赖于文件B而存在, 如果删除了文件B，打开文件A就会报错, 如果重新添加文件, 会消除错误. </p>
<blockquote>
<p>软链接和硬链接的最大不同在于, 软链接指向文件名, 硬链接指向inode</p>
</blockquote>
<ul>
<li>软链接<code>有自己的inode号</code>以及用户数据块</li>
<li>可对不存在的文件或目录创建软链接</li>
<li>软链接可对文件或目录创建</li>
<li>删除软链接并不影响被指向的文件, 但若被指向的原文件被删除，则相关软连接被称为<code>死链接</code></li>
</ul>
<blockquote>
<p>软链接可由命令<code>ln -s</code>创建</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ ln -s oldfile softfile</div><div class="line"></div><div class="line">$ ls -li| grep file</div><div class="line">16134546 -rw-r--r--   3 andrew_liu  staff        25  7  6 16:56 oldfile</div><div class="line">16135968 lrwxr-xr-x   1 andrew_liu  staff         7  7  6 17:19 softfile -&gt; oldfile</div></pre></td></tr></table></figure>
<blockquote>
<p>软链接创建时原文件的路径指向使用绝对路径较好</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># 查找某一目录下oldfile的软链接</div><div class="line">$ find /Users/andrew_liu/Downloads -lname oldfile</div><div class="line"></div><div class="line">/Users/andrew_liu/Downloads/softfile</div><div class="line"></div><div class="line"></div><div class="line"># 查找某一目录下oldfile的硬链接(包含自身)</div><div class="line">$ find /Users/andrew_liu/Downloads -samefile oldfile</div><div class="line"></div><div class="line">/Users/andrew_liu/Downloads/hardfile</div><div class="line">/Users/andrew_liu/Downloads/linkfile</div><div class="line">/Users/andrew_liu/Downloads/oldfile</div><div class="line"></div><div class="line"># 列出某路径下下的所有软链接文件</div><div class="line">$ find /Users/andrew_liu/Downloads -type l -ls</div></pre></td></tr></table></figure>
<h1 id="inode"><a href="#inode" class="headerlink" title="inode"></a>inode</h1><p>inode是UNIX操作系统中的一种数据结构, 它包含了与文件系统中各个文件相关的一些重要信息</p>
<p>文件数据存储在文件块(block, 记录文件的真实内容)中, 而在inode中存储文件的元数据(文件的附加属性，如文件大小、创建时间、所有者等信息).</p>
<p>在UNIX中, 目录本身就是文件, 只是在它们的inode 中使用了一些附加的设置. 目录本质上就是一个<code>包含了其他文件的文件</code>.</p>
<p><a href="http://fxr.watson.org/fxr/source/ufs/ufs/inode.h?v=RELENG61" target="_blank" rel="external">查看完整的inode结构体</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">struct inode &#123;</div><div class="line">    ...</div><div class="line">    /*</div><div class="line">     * Side effects; used during directory lookup.</div><div class="line">     */</div><div class="line">    int32_t   i_count;      /* Size of free slot in directory. */</div><div class="line">    doff_t    i_endoff;     /* End of useful stuff in directory. */</div><div class="line">    doff_t    i_diroff;     /* Offset in dir, where we found last entry. */</div><div class="line">    doff_t    i_offset;     /* Offset of free space in directory. */</div><div class="line">    ino_t     i_ino;        /* inode文件编号 */</div><div class="line">    u_int32_t i_reclen;     /* Size of found directory entry. * </div><div class="line">    union &#123;</div><div class="line">            struct dirhash *dirhash; /* Hashing for large directories. */</div><div class="line">            daddr_t *snapblklist;    /* Collect expunged snapshot blocks. */</div><div class="line">    &#125; i_un  </div><div class="line">    ...</div><div class="line">    /*</div><div class="line">     * Copies from the on-disk dinode itself.</div><div class="line">     */</div><div class="line">    u_int16_t i_mode;       /* 文件读写执行权限 */</div><div class="line">    int16_t   i_nlink;      /* 文件硬链接数 */</div><div class="line">    u_int64_t i_size;       /* 文件字节数 */</div><div class="line">    u_int32_t i_flags;      /* 状态标识(chflags). */</div><div class="line">    int64_t   i_gen;        /* Generation number. */</div><div class="line">    u_int32_t i_uid;        /* 文件拥有者ID */</div><div class="line">    u_int32_t i_gid;        /* 文件组 */</div><div class="line">   ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<blockquote>
<p>操作系统用inode号码来识别不同的文件而不是文件名, 文件名只是对于用户友好</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 列出当前目录下所有inode和文件名</div><div class="line">$ ls -i ./</div><div class="line"></div><div class="line"># 查看每个硬盘分区的inode总数和已经使用的数量</div><div class="line">$ df -i</div><div class="line"></div><div class="line"># 查看某一文件挂载在那个文件系统下</div><div class="line">$ df gitconfig</div></pre></td></tr></table></figure>
<h1 id="dotfiles配置备份"><a href="#dotfiles配置备份" class="headerlink" title="dotfiles配置备份"></a>dotfiles配置备份</h1><p><code>dotfiles</code>是配置文件集合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># 将vim的配置文件放到dotfiles文件夹下, dotfiles是自定义的文件夹</div><div class="line">$ mv .vim/vimrc ~/GitClone/dotfiles/vimrc</div><div class="line"># 将zsh的配置文件放到dotfiles文件夹下</div><div class="line">$ mv .zshrc ~/GitClone/dotfiles/zshrc</div><div class="line"># 将git的配置文件放到dotfiles文件夹下</div><div class="line">$ mv .gitconfig ~/GitClone/dotfiles/gitconfig</div><div class="line"></div><div class="line"># 对dotfiles文件夹中的配置文件建立软链接</div><div class="line">$ ln -s ~/GitClone/dotfiles/vimrc ~/.vim/vimrc</div><div class="line">$ ln -s ~/GitClone/dotfiles/zshrc ~/.zshrc</div><div class="line">$ ln -s ~/GitClone/dotfiles/gitconfig ~/.gitconfig</div></pre></td></tr></table></figure>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="http://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/" target="_blank" rel="external">理解 Linux 的硬链接与软链接</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2011/12/inode.html" target="_blank" rel="external">理解inode</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/aix/library/au-speakingunix14/" target="_blank" rel="external">对话 UNIX: 关于 inode</a></li>
<li><a href="http://dotfiles.github.io/" target="_blank" rel="external">Github著名dotfiles列表</a></li>
<li><a href="https://github.com/paulmillr/dotfiles" target="_blank" rel="external">https://github.com/paulmillr/dotfiles</a></li>
<li><a href="https://luolei.org/dotfiles-tutorial/" target="_blank" rel="external">dotfile入门</a></li>
<li><a href="https://medium.com/@webprolific/getting-started-with-dotfiles-43c3602fd789" target="_blank" rel="external">Getting Started With - Dotfiles</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2015/08/14/Unix内核源码剖析-书摘/" class="prev">上一篇</a><a href="/2015/07/31/Shell命令find-grep-xargs学习/" class="next">下一篇</a></div><div class="copyright"><p>© 2014 - 2017 <a href="http://andrewliu.in">Andrew Liu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-58158116-2",'auto');ga('send','pageview');</script></body></html>