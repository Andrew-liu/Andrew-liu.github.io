<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Python奇技淫巧 · Snow Memory | Andrew Liu</title><meta name="description" content="Python奇技淫巧 - Andrew Liu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://andrewliu.in/atom.xml" title="Snow Memory | Andrew Liu"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/dinosaurliu" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/Andrew-liu" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Python奇技淫巧</h1><div class="post-info">Nov 14, 2015</div><div class="post-content"><p>本博客采用创作共用版权协议, 要求署名、非商业用途和保持一致. 转载本博客文章必须也遵循<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" target="_blank" rel="external">署名-非商业用途-保持一致</a>的创作共用协议.</p>
<h2 id="显示有限的接口到外部"><a href="#显示有限的接口到外部" class="headerlink" title="显示有限的接口到外部"></a>显示有限的接口到外部</h2><p>当发布python第三方package时, 并不希望代码中所有的函数或者class可以被外部import, 在<code>__init__.py</code>中添加<code>__all__</code>属性,<br>该list中填写可以import的类或者函数名, 可以起到限制的import的作用, 防止外部import其他函数或者类</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python</div><div class="line"># -*- coding: utf-8 -*-</div><div class="line"></div><div class="line">from base import APIBase</div><div class="line">from client import Client</div><div class="line">from decorator import interface, export, stream</div><div class="line">from server import Server</div><div class="line">from storage import Storage</div><div class="line">from util import (LogFormatter, disable_logging_to_stderr,</div><div class="line">                       enable_logging_to_kids, info)</div><div class="line"></div><div class="line">__all__ = [&apos;APIBase&apos;, &apos;Client&apos;, &apos;LogFormatter&apos;, &apos;Server&apos;,</div><div class="line">           &apos;Storage&apos;, &apos;disable_logging_to_stderr&apos;, &apos;enable_logging_to_kids&apos;,</div><div class="line">           &apos;export&apos;, &apos;info&apos;, &apos;interface&apos;, &apos;stream&apos;]</div></pre></td></tr></table></figure>
<h2 id="with的魔力"><a href="#with的魔力" class="headerlink" title="with的魔力"></a>with的魔力</h2><p>with语句需要支持<code>上下文管理协议的对象</code>, 上下文管理协议包含<code>__enter__</code>和<code>__exit__</code>两个方法. with语句建立运行时上下文需要通过这两个方法执行<code>进入和退出</code>操作.</p>
<p>其中<code>上下文表达式</code>是跟在with之后的表达式, 该表示大返回一个上下文管理对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 常见with使用场景</div><div class="line">with open(&quot;test.txt&quot;, &quot;r&quot;) as my_file:  # 注意, 是__enter__()方法的返回值赋值给了my_file,</div><div class="line">    for line in my_file:</div><div class="line">        print line</div></pre></td></tr></table></figure>
<p>详细原理可以查看这篇文章, <a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/" target="_blank" rel="external">浅谈 Python 的 with 语句</a></p>
<p>知道具体原理, 我们可以自定义支持上下文管理协议的类, 类中实现<code>__enter__</code>和<code>__exit__</code>方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python</div><div class="line"># -*- coding: utf-8 -*-</div><div class="line"></div><div class="line">class MyWith(object):</div><div class="line"></div><div class="line">    def __init__(self):</div><div class="line">        print &quot;__init__ method&quot;</div><div class="line"></div><div class="line">    def __enter__(self):</div><div class="line">        print &quot;__enter__ method&quot;</div><div class="line">        return self  # 返回对象给as后的变量</div><div class="line"></div><div class="line">    def __exit__(self, exc_type, exc_value, exc_traceback):</div><div class="line">        print &quot;__exit__ method&quot;</div><div class="line">        if exc_traceback is None:</div><div class="line">            print &quot;Exited without Exception&quot;</div><div class="line">            return True</div><div class="line">        else:</div><div class="line">            print &quot;Exited with Exception&quot;</div><div class="line">            return False</div><div class="line"></div><div class="line">def test_with():</div><div class="line">    with MyWith() as my_with:</div><div class="line">        print &quot;running my_with&quot;</div><div class="line">    print &quot;------分割线-----&quot;</div><div class="line">    with MyWith() as my_with:</div><div class="line">        print &quot;running before Exception&quot;</div><div class="line">        raise Exception</div><div class="line">        print &quot;running after Exception&quot;</div><div class="line"></div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    test_with()</div></pre></td></tr></table></figure>
<p>执行结果如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">__init__ method</div><div class="line">__enter__ method</div><div class="line">running my_with</div><div class="line">__exit__ method</div><div class="line">Exited without Exception</div><div class="line">------分割线-----</div><div class="line">__init__ method</div><div class="line">__enter__ method</div><div class="line">running before Exception</div><div class="line">__exit__ method</div><div class="line">Exited with Exception</div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;bin/python&quot;, line 34, in &lt;module&gt;</div><div class="line">    exec(compile(__file__f.read(), __file__, &quot;exec&quot;))</div><div class="line">  File &quot;test_with.py&quot;, line 33, in &lt;module&gt;</div><div class="line">    test_with()</div><div class="line">  File &quot;test_with.py&quot;, line 28, in test_with</div><div class="line">    raise Exception</div><div class="line">Exception</div></pre></td></tr></table></figure>
<blockquote>
<p>证明了会先执行<code>__enter__</code>方法, 然后调用with内的逻辑, 最后执行<code>__exit__</code>做退出处理, 并且, 即使出现异常也能正常退出</p>
</blockquote>
<h2 id="filter的用法"><a href="#filter的用法" class="headerlink" title="filter的用法"></a>filter的用法</h2><p>相对<code>filter</code>而言, map和reduce使用的会更频繁一些, <code>filter</code>正如其名字, 按照某种规则<code>过滤</code>掉一些元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python</div><div class="line"># -*- coding: utf-8 -*-</div><div class="line"></div><div class="line">lst = [1, 2, 3, 4, 5, 6]</div><div class="line"># 所有奇数都会返回True, 偶数会返回False被过滤掉</div><div class="line">print filter(lambda x: x % 2 != 0, lst)</div><div class="line"></div><div class="line">#输出结果</div><div class="line">[1, 3, 5]</div></pre></td></tr></table></figure>
<h2 id="一行作判断"><a href="#一行作判断" class="headerlink" title="一行作判断"></a>一行作判断</h2><p>当条件满足时, 返回的为等号后面的变量, 否则返回else后语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">lst = [1, 2, 3]</div><div class="line">new_lst = lst[0] if lst is not None else None</div><div class="line">print new_lst</div><div class="line"></div><div class="line"># 打印结果</div><div class="line">1</div></pre></td></tr></table></figure>
<h2 id="装饰器之单例"><a href="#装饰器之单例" class="headerlink" title="装饰器之单例"></a>装饰器之单例</h2><blockquote>
<p>使用装饰器实现简单的单例模式</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"># 单例装饰器</div><div class="line">def singleton(cls):</div><div class="line">    instances = dict()  # 初始为空</div><div class="line">    def _singleton(*args, **kwargs):</div><div class="line">        if cls not in instances:  #如果不存在, 则创建并放入字典</div><div class="line">            instances[cls] = cls(*args, **kwargs)</div><div class="line">        return instances[cls]</div><div class="line">    return _singleton</div><div class="line"></div><div class="line">@singleton</div><div class="line">class Test(object):</div><div class="line">    pass</div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    t1 = Test()</div><div class="line">    t2 = Test()</div><div class="line">    # 两者具有相同的地址</div><div class="line">    print t1, t2</div></pre></td></tr></table></figure>
<h2 id="staticmethod装饰器"><a href="#staticmethod装饰器" class="headerlink" title="staticmethod装饰器"></a>staticmethod装饰器</h2><p>类中两种常用的装饰, 首先区分一下他们</p>
<ul>
<li>普通成员函数, 其中第一个隐式参数为<code>对象</code></li>
<li><code>classmethod装饰器</code>, 类方法(给人感觉非常类似于OC中的类方法), 其中第一个隐式参数为<code>类</code></li>
<li><code>staticmethod装饰器</code>, 没有任何隐式参数. <code>python中的静态方法类似与C++中的静态方法</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python</div><div class="line"># -*- coding: utf-8 -*-</div><div class="line"></div><div class="line">class A(object):</div><div class="line"></div><div class="line">    # 普通成员函数</div><div class="line">    def foo(self, x):</div><div class="line">        print &quot;executing foo(%s, %s)&quot; % (self, x)</div><div class="line"></div><div class="line">    @classmethod   # 使用classmethod进行装饰</div><div class="line">    def class_foo(cls, x):</div><div class="line">        print &quot;executing class_foo(%s, %s)&quot; % (cls, x)</div><div class="line"></div><div class="line">    @staticmethod  # 使用staticmethod进行装饰</div><div class="line">    def static_foo(x):</div><div class="line">        print &quot;executing static_foo(%s)&quot; % x</div><div class="line"></div><div class="line">def test_three_method():</div><div class="line">    obj = A()</div><div class="line">    # 直接调用噗通的成员方法</div><div class="line">    obj.foo(&quot;para&quot;)  # 此处obj对象作为成员函数的隐式参数, 就是self</div><div class="line">    obj.class_foo(&quot;para&quot;)  # 此处类作为隐式参数被传入, 就是cls</div><div class="line">    A.class_foo(&quot;para&quot;)  #更直接的类方法调用</div><div class="line">    obj.static_foo(&quot;para&quot;)  # 静态方法并没有任何隐式参数, 但是要通过对象或者类进行调用</div><div class="line">    A.static_foo(&quot;para&quot;)</div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    test_three_method()</div><div class="line">    </div><div class="line"># 函数输出</div><div class="line">executing foo(&lt;__main__.A object at 0x100ba4e10&gt;, para)</div><div class="line">executing class_foo(&lt;class &apos;__main__.A&apos;&gt;, para)</div><div class="line">executing class_foo(&lt;class &apos;__main__.A&apos;&gt;, para)</div><div class="line">executing static_foo(para)</div><div class="line">executing static_foo(para)</div></pre></td></tr></table></figure>
<h2 id="property装饰器"><a href="#property装饰器" class="headerlink" title="property装饰器"></a>property装饰器</h2><ul>
<li>定义私有类属性</li>
</ul>
<p>将<code>property</code>与装饰器结合实现属性私有化(<code>更简单安全的实现get和set方法</code>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#python内建函数</span></div><div class="line">property(fget=<span class="keyword">None</span>, fset=<span class="keyword">None</span>, fdel=<span class="keyword">None</span>, doc=<span class="keyword">None</span>)</div></pre></td></tr></table></figure>
<p><code>fget</code>是获取属性的值的函数,<code>fset</code>是设置属性值的函数,<code>fdel</code>是删除属性的函数,<code>doc</code>是一个字符串(like a comment).从实现来看，这些参数都是可选的</p>
<p>property有三个方法<code>getter()</code>, <code>setter()</code>和<code>delete()</code> 来指定fget, fset和fdel。 这表示以下这行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">class Student(object):</div><div class="line"></div><div class="line">    @property  #相当于property.getter(score) 或者property(score)</div><div class="line">    def score(self):</div><div class="line">        return self._score</div><div class="line"></div><div class="line">    @score.setter #相当于score = property.setter(score)</div><div class="line">    def score(self, value):</div><div class="line">        if not isinstance(value, int):</div><div class="line">            raise ValueError(&apos;score must be an integer!&apos;)</div><div class="line">        if value &lt; 0 or value &gt; 100:</div><div class="line">            raise ValueError(&apos;score must between 0 ~ 100!&apos;)</div><div class="line">        self._score = value</div></pre></td></tr></table></figure>
<h2 id="iter魔法"><a href="#iter魔法" class="headerlink" title="iter魔法"></a><strong>iter</strong>魔法</h2><ul>
<li>通过yield和<code>__iter__</code>的结合, 我们可以把一个对象变成可迭代的</li>
<li>通过<code>__str__</code>的重写, 可以直接通过想要的形式打印对象</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python</div><div class="line"># -*- coding: utf-8 -*-</div><div class="line"></div><div class="line">class TestIter(object):</div><div class="line"></div><div class="line">    def __init__(self):</div><div class="line">        self.lst = [1, 2, 3, 4, 5]</div><div class="line"></div><div class="line">    def read(self):</div><div class="line">        for ele in xrange(len(self.lst)):</div><div class="line">            yield ele</div><div class="line"></div><div class="line">    def __iter__(self):</div><div class="line">        return self.read()</div><div class="line"></div><div class="line">    def __str__(self):</div><div class="line">        return &apos;,&apos;.join(map(str, self.lst))</div><div class="line">    </div><div class="line">    __repr__ = __str__</div><div class="line"></div><div class="line">def test_iter():</div><div class="line">    obj = TestIter()</div><div class="line">    for num in obj:</div><div class="line">        print num</div><div class="line">    print obj</div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    test_iter()</div></pre></td></tr></table></figure>
<h2 id="神奇partial"><a href="#神奇partial" class="headerlink" title="神奇partial"></a>神奇partial</h2><p>partial使用上很像C++中仿函数(函数对象).</p>
<p><strong>在stackoverflow给出了类似与partial的运行方式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">def partial(func, *part_args):</div><div class="line">    def wrapper(*extra_args):</div><div class="line">        args = list(part_args)</div><div class="line">        args.extend(extra_args)</div><div class="line">        return func(*args)</div><div class="line"></div><div class="line">    return wrapper</div></pre></td></tr></table></figure>
<p>利用用闭包的特性绑定预先绑定一些函数参数, 返回一个可调用的变量, 直到真正的调用执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python</div><div class="line"># -*- coding: utf-8 -*-</div><div class="line"></div><div class="line">from functools import partial</div><div class="line"></div><div class="line">def sum(a, b):</div><div class="line">    return a + b</div><div class="line"></div><div class="line">def test_partial():</div><div class="line">    fun = partial(sum, 2)   # 事先绑定一个参数, fun成为一个只需要一个参数的可调用变量</div><div class="line">    print fun(3)  # 实现执行的即是sum(2, 3)</div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    test_partial()</div><div class="line">    </div><div class="line"># 执行结果</div><div class="line">5</div></pre></td></tr></table></figure>
<h2 id="神秘eval"><a href="#神秘eval" class="headerlink" title="神秘eval"></a>神秘eval</h2><p>eval我理解为一种内嵌的python解释器(这种解释可能会有偏差), 会解释字符串为对应的代码并执行, 并且将执行结果返回</p>
<p>看一下下面这个例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python</div><div class="line"># -*- coding: utf-8 -*-</div><div class="line"></div><div class="line">def test_first():</div><div class="line">    return 3</div><div class="line"></div><div class="line">def test_second(num):</div><div class="line">    return num</div><div class="line"></div><div class="line">action = &#123;  # 可以看做是一个sandbox</div><div class="line">        &quot;para&quot;: 5,</div><div class="line">        &quot;test_first&quot; : test_first,</div><div class="line">        &quot;test_second&quot;: test_second</div><div class="line">        &#125;</div><div class="line"></div><div class="line">def test_eavl():  </div><div class="line">    condition = &quot;para == 5 and test_second(test_first) &gt; 5&quot;</div><div class="line">    res = eval(condition, action)  # 解释condition并根据action对应的动作执行</div><div class="line">    print res</div><div class="line"></div><div class="line">if __name__ == &apos;_</div></pre></td></tr></table></figure>
<h2 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h2><ul>
<li>exec在Python中会忽略返回值, 总是返回None, eval会返回执行代码或语句的返回值</li>
<li><code>exec</code>和<code>eval</code>在执行代码时, 除了返回值其他行为都相同</li>
<li>在传入字符串时, 会使用<code>compile(source, &#39;&lt;string&gt;&#39;, mode)</code>编译字节码. mode的取值为<code>exec</code>和<code>eval</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python</div><div class="line"># -*- coding: utf-8 -*-</div><div class="line"></div><div class="line">def test_first():</div><div class="line">    print &quot;hello&quot;</div><div class="line"></div><div class="line">def test_second():</div><div class="line">    test_first()</div><div class="line">    print &quot;second&quot;</div><div class="line"></div><div class="line">def test_third():</div><div class="line">    print &quot;third&quot;</div><div class="line"></div><div class="line">action = &#123;</div><div class="line">        &quot;test_second&quot;: test_second,</div><div class="line">        &quot;test_third&quot;: test_third</div><div class="line">        &#125;</div><div class="line"></div><div class="line">def test_exec():</div><div class="line">    exec &quot;test_second&quot; in action</div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    test_exec()  # 无法看到执行结果</div></pre></td></tr></table></figure>
<h2 id="getattr"><a href="#getattr" class="headerlink" title="getattr"></a>getattr</h2><p><code>getattr(object, name[, default])</code>Return the value of the named attribute of object. name must be a string. If the string is the name of one of the object’s attributes, the result is the value of that attribute. For example, getattr(x, ‘foobar’) is equivalent to x.foobar. If the named attribute does not exist, default is returned if provided, otherwise AttributeError is raised.</p>
<p>通过string类型的name, 返回对象的name属性(方法)对应的值, 如果属性不存在, 则返回默认值, 相当于object.name</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"># 使用范例</div><div class="line">class TestGetAttr(object):</div><div class="line"></div><div class="line">    test = &quot;test attribute&quot;</div><div class="line"></div><div class="line">    def say(self):</div><div class="line">        print &quot;test method&quot;</div><div class="line"></div><div class="line">def test_getattr():</div><div class="line">    my_test = TestGetAttr()</div><div class="line">    try:</div><div class="line">        print getattr(my_test, &quot;test&quot;)</div><div class="line">    except AttributeError:</div><div class="line">        print &quot;Attribute Error!&quot;</div><div class="line">    try:</div><div class="line">        getattr(my_test, &quot;say&quot;)()</div><div class="line">    except AttributeError: # 没有该属性, 且没有指定返回值的情况下</div><div class="line">        print &quot;Method Error!&quot;</div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    test_getattr()</div><div class="line">    </div><div class="line"># 输出结果</div><div class="line">test attribute</div><div class="line">test method</div></pre></td></tr></table></figure>
<h2 id="命令行处理"><a href="#命令行处理" class="headerlink" title="命令行处理"></a>命令行处理</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_command_line</span><span class="params">(argv)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Return a 2-tuple: (settings object, args list).</div><div class="line">    `argv` is a list of arguments, or `None` for ``sys.argv[1:]``.</div><div class="line">    """</div><div class="line">    <span class="keyword">if</span> argv <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">        argv = sys.argv[<span class="number">1</span>:]</div><div class="line"></div><div class="line">    <span class="comment"># initialize the parser object:</span></div><div class="line">    parser = optparse.OptionParser(</div><div class="line">        formatter=optparse.TitledHelpFormatter(width=<span class="number">78</span>),</div><div class="line">        add_help_option=<span class="keyword">None</span>)</div><div class="line"></div><div class="line">    <span class="comment"># define options here:</span></div><div class="line">    parser.add_option(      <span class="comment"># customized description; put --help last</span></div><div class="line">        <span class="string">'-h'</span>, <span class="string">'--help'</span>, action=<span class="string">'help'</span>,</div><div class="line">        help=<span class="string">'Show this help message and exit.'</span>)</div><div class="line"></div><div class="line">    settings, args = parser.parse_args(argv)</div><div class="line"></div><div class="line">    <span class="comment"># check number of arguments, verify values, etc.:</span></div><div class="line">    <span class="keyword">if</span> args:</div><div class="line">        parser.error(<span class="string">'program takes no command-line arguments; '</span></div><div class="line">                     <span class="string">'"%s" ignored.'</span> % (args,))</div><div class="line"></div><div class="line">    <span class="comment"># further process settings &amp; args if necessary</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> settings, args</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv=None)</span>:</span></div><div class="line">    settings, args = process_command_line(argv)</div><div class="line">    <span class="comment"># application code here, like:</span></div><div class="line">    <span class="comment"># run(settings, args)</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>        <span class="comment"># success</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    status = main()</div><div class="line">    sys.exit(status)</div></pre></td></tr></table></figure>
<h2 id="读写csv文件"><a href="#读写csv文件" class="headerlink" title="读写csv文件"></a>读写csv文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># 从csv中读取文件, 基本和传统文件读取类似</div><div class="line">import csv</div><div class="line">with open(&apos;data.csv&apos;, &apos;rb&apos;) as f:</div><div class="line">    reader = csv.reader(f)</div><div class="line">    for row in reader:</div><div class="line">        print row</div><div class="line"># 向csv文件写入</div><div class="line">import csv</div><div class="line">with open( &apos;data.csv&apos;, &apos;wb&apos;) as f:</div><div class="line">    writer = csv.writer(f)</div><div class="line">    writer.writerow([&apos;name&apos;, &apos;address&apos;, &apos;age&apos;])  # 单行写入</div><div class="line">    data = [</div><div class="line">            ( &apos;xiaoming &apos;,&apos;china&apos;,&apos;10&apos;),</div><div class="line">            ( &apos;Lily&apos;, &apos;USA&apos;, &apos;12&apos;)]</div><div class="line">    writer.writerows(data)  # 多行写入</div></pre></td></tr></table></figure>
<h2 id="各种时间形式转换"><a href="#各种时间形式转换" class="headerlink" title="各种时间形式转换"></a>各种时间形式转换</h2><p><strong>只发一张网上的图, 然后差文档就好了, 这个是记不住的</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/ab508d3djw1exykn9rbe1j20kj0f977t.jpg" alt="记不住"></p>
<h2 id="字符串格式化"><a href="#字符串格式化" class="headerlink" title="字符串格式化"></a>字符串格式化</h2><p>一个非常好用, 很多人又不知道的功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; name = &quot;andrew&quot;</div><div class="line">&gt;&gt;&gt; &quot;my name is &#123;name&#125;&quot;.format(name=name)</div><div class="line">&apos;my name is andrew&apos;</div></pre></td></tr></table></figure>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="http://stackoverflow.com/questions/136097/what-is-the-difference-between-staticmethod-and-classmethod-in-python" target="_blank" rel="external">What is the difference between @staticmethod and @classmethod in Python?</a></li>
<li><a href="http://stackoverflow.com/questions/6618002/python-property-versus-getters-and-setters" target="_blank" rel="external">Python @property versus getters and setters</a></li>
<li><a href="http://stackoverflow.com/questions/17330160/how-does-the-property-decorator-work" target="_blank" rel="external">How does the @property decorator work?</a></li>
<li><a href="http://stackoverflow.com/questions/15331726/how-does-the-functools-partial-work-in-python" target="_blank" rel="external">How does the functools partial work in Python?</a></li>
<li><a href="http://stackoverflow.com/questions/2220699/whats-the-difference-between-eval-exec-and-compile-in-python" target="_blank" rel="external">What’s the difference between eval, exec, and compile in Python?</a></li>
<li><a href="http://lucumr.pocoo.org/2011/2/1/exec-in-python/" target="_blank" rel="external">Be careful with exec and eval in Python</a></li>
<li><a href="http://stackoverflow.com/questions/4859129/python-and-python-c-api-new-versus-init/" target="_blank" rel="external">Python (and Python C API): <strong>new</strong> versus <strong>init</strong></a></li>
<li><a href="http://stackoverflow.com/questions/6019627/python-self-keyword" target="_blank" rel="external">Python ‘self’ keyword</a> <code>self</code>不是关键字, 是一个约定的变量名</li>
<li><a href="http://www.dongwm.com/" target="_blank" rel="external">Python进阶必读汇总</a></li>
<li><a href="http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html#truth-values" target="_blank" rel="external">使python类可以判断真值</a></li>
<li><a href="http://www.fullstackpython.com/best-python-resources.html" target="_blank" rel="external">Best Python Resources</a></li>
<li><a href="http://drops.wooyun.org/tips/10383" target="_blank" rel="external">Python安全编码指南</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2015/11/21/sed-awk学习笔记/" class="prev">PREV</a><a href="/2015/11/07/Buildout使用小结/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'snow-memory';
var disqus_identifier = '2015/11/14/Python奇技淫巧/';
var disqus_title = 'Python奇技淫巧';
var disqus_url = 'http://andrewliu.in/2015/11/14/Python奇技淫巧/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//snow-memory.disqus.com/count.js" async></script><div class="copyright"><p>© 2014 - 2017 <a href="http://andrewliu.in">Andrew Liu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-58158116-2",'auto');ga('send','pageview');</script></body></html>