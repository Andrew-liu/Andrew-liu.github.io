<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Git远程协作和分支技巧 · Snow Memory | Andrew Liu</title><meta name="description" content="Git远程协作和分支技巧 - Andrew Liu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://andrewliu.in/atom.xml" title="Snow Memory | Andrew Liu"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/dinosaurliu" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/Andrew-liu" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Git远程协作和分支技巧</h1><div class="post-info">Oct 27, 2014</div><div class="post-content"><p><img src="http://byson.img42.wal8.com/img42/434369_20140909170142/141445862765.png" alt="Git"></p>
<p>#0. 简单Git操作,SSH设置回顾</p>
<p><a href="http://andrewliu.tk/Install-SSH-Use-Github/" target="_blank" rel="external">一些简单的git操作</a></p>
<p><a href="http://andrewliu.tk/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" target="_blank" rel="external">常用的git操作</a></p>
<p>#1. 工作区和暂存区和分支</p>
<blockquote>
<p>重新回顾一下Git中最重要的<code>暂存区</code>概念</p>
</blockquote>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">git add filename -&gt; 将文件提交的所有修改暂存到暂存区</div><div class="line">git commit -m &quot;some tips&quot; -&gt; 将文件修改提交到分支, 默认为master分支,即主分区</div><div class="line"></div><div class="line"></div><div class="line">git diff HEAD -- filename -&gt;可以查看工作区和版本库里面最新版本的区别, 其中HEAD表示版本库中的当前版本</div><div class="line"></div><div class="line">git checkout -- filename -&gt;丢弃工作区的修改</div><div class="line"></div><div class="line">&quot;&quot;&quot;</div><div class="line">把filename文件在工作区的修改全部撤销，这里有两种情况：</div><div class="line">一种是filename自修改后还没有被放到暂存区，现在，撤销修改就回到和版本库一模一样的状态</div><div class="line">一种是filename已经添加到暂存区后，又作了修改，现在，撤销修改就回到添加到暂存区后的状态。</div><div class="line">总之，就是让这个文件回到最近一次git commit或git add时的状态。</div><div class="line"> - 摘自廖雪峰的git教程</div><div class="line"> </div><div class="line"> </div><div class="line"> #git checkout其实是用版本库里的版本替换工作区的版本</div><div class="line">&quot;&quot;&quot;</div><div class="line"></div><div class="line">git reset HEAD file -&gt;可以把暂存区的修改撤销掉（unstage），重新放回工作区</div></pre></td></tr></table></figure>
<ul>
<li><strong>删除操作</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#删除已经commit的文件, 然后再次commit</div><div class="line">git add filename</div></pre></td></tr></table></figure>
<p>#2. 分支管理</p>
<blockquote>
<p>进入正题 : <code>分支管理</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">git branch branchname       #创建分支branchname </div><div class="line">git checkout branchname     #切换分支到branchname</div><div class="line"></div><div class="line">git checkout -b branchname  #这条命令执行上面两个命令的功能, 也就是创建并切换到分支branchname</div><div class="line"></div><div class="line">git branch                  #列出所有的分支,当前分支前面会标一个*号</div><div class="line"></div><div class="line">➜  Team git:(team) ✗ git branch</div><div class="line">  master</div><div class="line">* team</div><div class="line"></div><div class="line">#在分支上的修改和默认master的修改是独立的, 也就是说在分支上进行修改后, 切换会master里, master的整个工作区与在分支修改之前是保持不变的</div><div class="line">git merge branchname        #将分支的修改合并到master</div><div class="line"></div><div class="line"></div><div class="line"> git branch -d branchname   #合并结束后用于删除分支, 注意-d</div></pre></td></tr></table></figure>
<blockquote>
<p>当master和分支上分别进行了版本commit后, 就会造成冲突</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">#我对master和分支上的README.md进行了修改和一次commit后, 造成冲突</div><div class="line">Auto-merging README.md</div><div class="line">CONFLICT (content): Merge conflict in README.md</div><div class="line">Automatic merge failed; fix conflicts and then commit the result</div><div class="line"></div><div class="line">➜  Team git:(master) ✗ git status</div><div class="line">On branch master</div><div class="line">You have unmerged paths.</div><div class="line">  (fix conflicts and run &quot;git commit&quot;)</div><div class="line"></div><div class="line">Unmerged paths:</div><div class="line">  (use &quot;git add &lt;file&gt;...&quot; to mark resolution)</div><div class="line"></div><div class="line">    both modified:   README.md   #注意显示both modified</div><div class="line">#此时提交的文件也发生了变化</div><div class="line"></div><div class="line">此时进入文件后解决冲突, 然后重新提交</div><div class="line">git log --graph --pretty=oneline --abbrev-commit #commit使用整个命令查看分支合并情况</div></pre></td></tr></table></figure>
<ol>
<li>出现冲突时，在master修改冲突并commit之前无法切换到branchname 分支。</li>
<li>master修改冲突并提交之后切换到branchname，发现branchname内容保持原来不变。</li>
</ol>
<p>#3. 多人协作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git push origin master      #用于推送master分支,</div><div class="line">git push origin branchname  #用于推送分支</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">以下语句摘自廖雪峰, 具体操作请看下面代码</div><div class="line"></div><div class="line">多人协作的工作模式通常是这样：</div><div class="line">1. 首先，可以试图用git push origin branch-name推送自己的修改；</div><div class="line">2. 如果推送失败，则因为远程分支比你的本地更新，需要先用git pull试图合并；</div><div class="line">3. 如果合并有冲突，则解决冲突，并在本地提交；</div><div class="line">4. 没有冲突或者解决掉冲突后，再用git push origin branchname推送就能成功！</div><div class="line"></div><div class="line">&gt; 如果git pull提示“no tracking information”，则说明本地分支和远程分支的链接关系没有创建，用命令`git branch --set-upstream branchname origin/branch-name`。</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">远程协作的整体步骤总结</div><div class="line">1. git clone XXXX   #克隆仓库</div><div class="line">2. git branch -a    #查看远程分支</div><div class="line"></div><div class="line">#假设有以下这些分支</div><div class="line">* master</div><div class="line">  remotes/origin/HEAD -&gt; origin/master</div><div class="line">  remotes/origin/master</div><div class="line">  remotes/origin/team</div><div class="line"> </div><div class="line">#若只有master分支, 可以在本地创建新的分支, 然后切换到分支工作后, 直接进行commit, 然后git push origin remotebranchname, 这句话会再远程创建一个分支名为remotebranchname</div><div class="line"></div><div class="line">3. git checkout -b team origin/team   #创建本地分支和要跟踪的远程推送分支</div><div class="line">4. git commit -m &quot;add something&quot;      #首先对分支内容进行一些修改在team分支修改并提交</div><div class="line">5. git push origin team               #推送到远程分支team</div><div class="line"></div><div class="line">#以下为推送成功信息</div><div class="line">Counting objects: 7, done.</div><div class="line">Delta compression using up to 4 threads.</div><div class="line">Compressing objects: 100% (2/2), done.</div><div class="line">Writing objects: 100% (3/3), 275 bytes | 0 bytes/s, done.</div><div class="line">Total 3 (delta 1), reused 0 (delta 0)</div><div class="line">To git@github.com:Andrew-liu/CradleStudio.git</div><div class="line">   a1de49f..3b6e09b  team -&gt; team</div><div class="line"> </div><div class="line"> #以下是协作冲突的处理, 此处code是远程仓库的代号, 可以通过git remote -v查看, code相当于默认的origin,即要推送或拉取的仓库</div><div class="line"> </div><div class="line">6. git push code team       </div><div class="line"></div><div class="line">#此时另一个协作着对同一个远程分支进行推送会发生错误</div><div class="line">To git@github.com:Andrew-liu/CradleStudio.git</div><div class="line"> ! [rejected]        team -&gt; team (fetch first)</div><div class="line">error: failed to push some refs to &apos;git@github.com:Andrew-liu/CradleStudio.git&apos;</div><div class="line">hint: Updates were rejected because the remote contains work that you do</div><div class="line">hint: not have locally. This is usually caused by another repository pushing</div><div class="line">hint: to the same ref. You may want to first integrate the remote changes</div><div class="line">hint: (e.g., &apos;git pull ...&apos;) before pushing again.</div><div class="line">hint: See the &apos;Note about fast-forwards&apos; in &apos;git push --help&apos; for details.</div><div class="line"></div><div class="line">7. git pull code team         #首先应尝试pull解决冲突</div><div class="line">From github.com:Andrew-liu/CradleStudio</div><div class="line"> * branch            team       -&gt; FETCH_HEAD</div><div class="line">   a1de49f..3b6e09b  team       -&gt; code/team</div><div class="line">Auto-merging README.md</div><div class="line">CONFLICT (content): Merge conflict in README.md</div><div class="line">Automatic merge failed; fix conflicts and then commit the resul</div><div class="line"></div><div class="line">8. 手动合并冲突, 查看冲突的文件, 会有明确的冲突信息标注</div><div class="line">9. 重新推送成功</div><div class="line">   3b6e09b..7bc0cfa  team -&gt; team   #修改推送成功, 完成一次远程协作</div></pre></td></tr></table></figure>
<p>#4. 参考连接<br><a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/001374385852170d9c7adf13c30429b9660d0eb689dd43a000" target="_blank" rel="external">廖雪峰的Git教程</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2014/10/28/2014-10-28-Python常用用法总结_自用/" class="prev">PREV</a><a href="/2014/10/27/2014-10-27-Python中随机数Random和Math模块/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'snow-memory';
var disqus_identifier = '2014/10/27/2014-10-27-Git远程协作和分支技巧/';
var disqus_title = 'Git远程协作和分支技巧';
var disqus_url = 'http://andrewliu.in/2014/10/27/2014-10-27-Git远程协作和分支技巧/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//snow-memory.disqus.com/count.js" async></script><div class="copyright"><p>© 2014 - 2017 <a href="http://andrewliu.in">Andrew Liu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-58158116-2",'auto');ga('send','pageview');</script></body></html>