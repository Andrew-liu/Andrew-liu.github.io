<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Python爬虫(三)--Coursera抓站小结 · Snow Memory | Andrew Liu</title><meta name="description" content="Python爬虫(三)--Coursera抓站小结 - Andrew Liu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://andrewliu.in/atom.xml" title="Snow Memory | Andrew Liu"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/dinosaurliu" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/Andrew-liu" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Python爬虫(三)--Coursera抓站小结</h1><div class="post-info">Dec 14, 2014</div><div class="post-content"><hr>
<hr>
<blockquote>
<p>系统:Mac OS X 10.10.1<br>编辑器: <a href="">Sublime Text2</a><br>Python版本: 2.7.8<br>模块依赖: import sys, string, re, random, urllib, urllib2, cookielib, getpass(<code>均为系统内的模块</code>)</p>
</blockquote>
<hr>
<p>#0. 抓站小结</p>
<p>##0.1. cookie处理<br>需要进行登陆的时候, 要进行cookie的处理,使用以下方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cookie = cookielib.CookieJar()</div><div class="line">opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookie))</div><div class="line">urllib2.install_opener(opener)</div><div class="line">req = urllib2.Request(url)</div><div class="line">content = urllib2.urlopen(req)</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>##0.2. 表单处理<br>某些网站需要进行账户和密码登陆, 需要使用POST方法向服务器发送账户和密码表单数据, 这里就需要模拟登陆.</p>
<blockquote>
<p>如何获取表单数据的格式呢?</p>
</blockquote>
<p>通过谷歌浏览器开发者工具中Network锁定请求头部和post发出的表单数据,伪装表单数据</p>
<blockquote>
<p>当由于Method太多, 找不到POST提交登录请求Method方法的时候, 可以尝试使用错误密码, 这样就可以容易的找POST方法对应的头部.</p>
</blockquote>
<p><img src="http://picturebag.qiniudn.com/Snip20141207_2.png" alt="找到POST方法"><br><img src="http://picturebag.qiniudn.com/Snip20141207_3.png" alt="表单处理"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">form_data = urllib.urlencode(&#123;  <span class="comment">#注意urlencode方法</span></div><div class="line">    <span class="string">"email"</span>: self.user_name,</div><div class="line">    <span class="string">"password"</span>: self.password,</div><div class="line">    <span class="string">"webrequest"</span>: <span class="string">"true"</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>##0.3. 防盗链和伪装成浏览器访问</p>
<p>防盗链就是需要在请求的头部加入<code>Referer</code>字段, Referer 指的是HTTP头部的一个字段, 用来表示从哪儿链接到目前的网页，采用的格式是URL。换句话说，借着 HTTP Referer 头部网页可以检查访客从哪里而来，这也常被用来对付伪造的跨网站请求。</p>
<p>伪装成浏览器就是将<code>User-Agent设置为浏览器的字段</code></p>
<p><img src="http://picturebag.qiniudn.com/Snip20141207_5.png" alt="伪装头部"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">user_agent = (<span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) "</span></div><div class="line">    <span class="string">"AppleWebKit/537.36 (KHTML, like Gecko) "</span></div><div class="line">    <span class="string">"Chrome/38.0.2125.111 Safari/537.36"</span>)</div><div class="line">request_header = &#123;</div><div class="line">    <span class="string">"Referer"</span>: <span class="string">"https://accounts.coursera.org/signin"</span>,  <span class="comment">#对付防盗链设置, 为跳转来源的url</span></div><div class="line">    <span class="string">"User-Agent"</span>: user_agent, <span class="comment">#伪装成浏览器访问</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>#1. 伪装头部</p>
<p>使用<code>谷歌浏览器自带的开发者工具</code>, 选择<code>Network</code>(<code>Element用来查看网站源码等功能</code>), 获取详细的GET和POST方法, 从中获取<code>登录请求</code>的的头部信息,<br>从POST中获得Headers信息如下(<code>省略部分不重要信息</code>)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Request URL:https:<span class="comment">//accounts.coursera.org/api/v1/login  //真正的登陆验证页面</span></div><div class="line">Request Method:POST</div><div class="line">Status Code:<span class="number">401</span> Unauthorized</div><div class="line"></div><div class="line"><span class="comment">//Request Headers</span></div><div class="line">Connection:keep-alive</div><div class="line">Content-Length:<span class="number">55</span></div><div class="line">Content-Type:application/x-www-form-urlencoded</div><div class="line">Cookie:(省略cookie信息, 下面详细介绍)</div><div class="line">...</div><div class="line">Referer:https:<span class="comment">//accounts.coursera.org/signin //防盗链设置</span></div><div class="line">User-Agent:Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">6.1</span>; WOW64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">39.0</span><span class="number">.2171</span><span class="number">.71</span> Safari/<span class="number">537.36</span>  <span class="comment">//浏览器浏览标识</span></div><div class="line"><span class="comment">//下面四行为服务器所做的限制字段</span></div><div class="line">X-CSRF2-Cookie:csrf2_token_el67QDLg</div><div class="line">X-CSRF2-Token:<span class="number">1</span>oxZDVMuZGX0qCggdReQyj2R</div><div class="line">X-CSRFToken:WnVtiMDpvw0JXJqHjPrFk0EU</div><div class="line">X-Requested-With:XMLHttpRequest</div><div class="line"></div><div class="line"><span class="comment">//Form Data</span></div><div class="line">email:<span class="number">1095.</span>..@qq.com <span class="comment">//Coursera账户信息 </span></div><div class="line">password:FAFA  <span class="comment">//账户密码</span></div><div class="line">webrequest:<span class="literal">true</span> <span class="comment">//固定字段</span></div></pre></td></tr></table></figure>
<p>这样就能写出模拟头部的函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">structure_headers</span><span class="params">(self)</span> :</span></div><div class="line">        <span class="comment">#模拟表单数据,这个参数不是字典</span></div><div class="line">        form_data = urllib.urlencode(&#123;</div><div class="line">            <span class="string">"email"</span>: self.user_name,</div><div class="line">            <span class="string">"password"</span>: self.password,</div><div class="line">            <span class="string">"webrequest"</span>: <span class="string">"true"</span></div><div class="line">        &#125;)  </div><div class="line">        user_agent = (<span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) "</span></div><div class="line">            <span class="string">"AppleWebKit/537.36 (KHTML, like Gecko) "</span></div><div class="line">            <span class="string">"Chrome/38.0.2125.111 Safari/537.36"</span>)</div><div class="line">        request_header = &#123;</div><div class="line">            <span class="string">"Referer"</span>: <span class="string">"https://accounts.coursera.org/signin"</span>,  <span class="comment">#对付防盗链设置, 为跳转来源的url</span></div><div class="line">            <span class="string">"User-Agent"</span>: user_agent, <span class="comment">#伪装成浏览器访问</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> form_data, request_header</div></pre></td></tr></table></figure>
<p>试了几次竟然都是<code>400错误</code>, 也就是头部请求的格式不正确, 通过多次Headers查看, 发现有下面四处不同的头部</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">X-CSRF2-Cookie:csrf2_token_hTu4Zy8Y  最后八位不同</div><div class="line">X-CSRF2-Token:O5OIRan9I99lTHmnYS27ocYb  完全随机</div><div class="line">X-CSRFToken:HClYbs9HZoGweU54iR5r5z2y 完全随机</div><div class="line">X-Requested-With:XMLHttpRequest  固定不变</div></pre></td></tr></table></figure>
<blockquote>
<p>通过放上搜索找到了解决方案, coursera的请求头部中<code>X-CSRF2-Token和X-CSRFToken</code>是完全随机的, <code>X-CSRF2-Cookie</code>后八位是随机生成的, 都是由字母和数字随机生成的.</p>
</blockquote>
<p>于是修改代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">structure_headers</span><span class="params">(self)</span> :</span></div><div class="line">    <span class="comment">#模拟表单数据,这个参数不是字典</span></div><div class="line">    form_data = urllib.urlencode(&#123;</div><div class="line">        <span class="string">"email"</span>: self.user_name,</div><div class="line">        <span class="string">"password"</span>: self.password,</div><div class="line">        <span class="string">"webrequest"</span>: <span class="string">"true"</span></div><div class="line">    &#125;)  </div><div class="line">    user_agent = (<span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) "</span></div><div class="line">        <span class="string">"AppleWebKit/537.36 (KHTML, like Gecko) "</span></div><div class="line">        <span class="string">"Chrome/38.0.2125.111 Safari/537.36"</span>)</div><div class="line">    XCSRF2Cookie = <span class="string">'csrf2_token_%s'</span> % <span class="string">''</span>.join(self.random_string(<span class="number">8</span>))</div><div class="line">    XCSRF2Token = <span class="string">''</span>.join(self.random_string(<span class="number">24</span>))</div><div class="line">    XCSRFToken = <span class="string">''</span>.join(self.random_string(<span class="number">24</span>))</div><div class="line">    cookie = <span class="string">"csrftoken=%s; %s=%s"</span> % (XCSRFToken, XCSRF2Cookie, XCSRF2Token)</div><div class="line"></div><div class="line">    request_header = &#123;</div><div class="line">        <span class="string">"Referer"</span>: <span class="string">"https://accounts.coursera.org/signin"</span>,  <span class="comment">#对付防盗链设置, 为跳转来源的url</span></div><div class="line">        <span class="string">"User-Agent"</span>: user_agent, <span class="comment">#伪装成浏览器访问</span></div><div class="line">        <span class="string">"X-Requested-With"</span>: <span class="string">"XMLHttpRequest"</span>,</div><div class="line">        <span class="string">"X-CSRF2-Cookie"</span>: XCSRF2Cookie,</div><div class="line">        <span class="string">"X-CSRF2-Token"</span>: XCSRF2Token,</div><div class="line">        <span class="string">"X-CSRFToken"</span>: XCSRFToken,</div><div class="line">        <span class="string">"Cookie"</span>: cookie</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> form_data, request_header</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_string</span><span class="params">(self, length)</span>:</span></div><div class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(random.choice(string.letters + string.digits) <span class="keyword">for</span> i <span class="keyword">in</span> xrange(length))</div></pre></td></tr></table></figure>
<p>#2. 模拟登陆</p>
<p>登陆coursra的下载页面时<a href="https://class.coursera.org/pkuco-001/lecture" target="_blank" rel="external">计算机组成视频下载</a>, 会发现是要求登陆呢, 这时候就使用<code>cookielib</code>模块进行cookie的处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">simulation_login</span><span class="params">(self)</span> :</span></div><div class="line">    cookie = cookielib.CookieJar()</div><div class="line">    opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookie))</div><div class="line">    urllib2.install_opener(opener)</div><div class="line">    form_data, request_header = self.structure_headers()</div><div class="line">    req = urllib2.Request(self.login_url, data = form_data, headers = request_header)</div><div class="line">    <span class="keyword">try</span> :</div><div class="line">        result = urllib2.urlopen(req)</div><div class="line">    <span class="keyword">except</span> urllib2.URLError,e :</div><div class="line">        <span class="keyword">if</span> hasattr(e, <span class="string">"code"</span>):</div><div class="line">            <span class="keyword">print</span> <span class="string">"The server couldn't fulfill the request.Please check your url and read the Reason"</span></div><div class="line">            <span class="keyword">print</span> <span class="string">"Error code: %s"</span> % e.code</div><div class="line">        <span class="keyword">elif</span> hasattr(e, <span class="string">"reason"</span>):</div><div class="line">            <span class="keyword">print</span> <span class="string">"We failed to reach a server. Please check your url and read the Reason"</span></div><div class="line">            <span class="keyword">print</span> <span class="string">"Reason: %s"</span> % e.reason</div><div class="line">        sys.exit(<span class="number">2</span>)</div><div class="line">    <span class="keyword">if</span> result.getcode() == <span class="number">200</span> :</div><div class="line">        <span class="keyword">print</span> <span class="string">"登陆成功..."</span></div></pre></td></tr></table></figure>
<p>这个函数用于模拟登陆, 并显示登陆成功或者失败</p>
<p>#3. 抓取下载链接</p>
<p>抓取链接通过正则表达式, 主要匹配<code>PDF下载链接和MP4视频下载链接</code></p>
<p>使用<code>re.findall()</code>函数进行函数匹配</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_links</span><span class="params">(self)</span> :</span></div><div class="line">    <span class="keyword">try</span> :</div><div class="line">        result = urllib2.urlopen(self.url)</div><div class="line">    <span class="keyword">except</span> urllib2.URLError,e :</div><div class="line">        <span class="keyword">if</span> hasattr(e, <span class="string">"code"</span>):</div><div class="line">            <span class="keyword">print</span> <span class="string">"The server couldn't fulfill the request."</span></div><div class="line">            <span class="keyword">print</span> <span class="string">"Error code: %s"</span> % e.code</div><div class="line">        <span class="keyword">elif</span> hasattr(e, <span class="string">"reason"</span>):</div><div class="line">            <span class="keyword">print</span> <span class="string">"We failed to reach a server. Please check your url and read the Reason"</span></div><div class="line">            <span class="keyword">print</span> <span class="string">"Reason: %s"</span> % e.reason</div><div class="line">        sys.exit(<span class="number">2</span>)</div><div class="line">    content = result.read().decode(<span class="string">"utf-8"</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">"读取网页成功..."</span></div><div class="line">    down_links = re.findall(<span class="string">r'&lt;a.*?href="(.*?mp4.*?)"'</span>, content)</div><div class="line">    down_pdfs = re.findall(<span class="string">r'&lt;a.*?href="(.*?pdf)"'</span>, content)</div><div class="line">    <span class="keyword">print</span> <span class="string">"正则匹配结束..."</span></div><div class="line">    <span class="keyword">return</span> down_links, down_pdfs</div></pre></td></tr></table></figure>
<p>#4. 写入完本</p>
<p>既然已经匹配了所有的链接, 这一步就是将链接写入到文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_spider</span><span class="params">(self)</span> :</span></div><div class="line">    self.simulation_login()</div><div class="line">    down_links, down_pdfs = self.get_links()</div><div class="line">    <span class="keyword">with</span> open(<span class="string">"coursera.html"</span>, <span class="string">"w+"</span>) <span class="keyword">as</span> my_file :</div><div class="line">        <span class="keyword">print</span> <span class="string">"下载链接的长度"</span>, len(down_links)</div><div class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> down_links :</div><div class="line">            <span class="keyword">print</span> link</div><div class="line">            <span class="keyword">try</span> :</div><div class="line">                my_file.write(link + <span class="string">"\n"</span>)</div><div class="line">            <span class="keyword">except</span> UnicodeEncodeError:</div><div class="line">                sys.exit(<span class="number">2</span>)</div><div class="line">    <span class="keyword">with</span> open(<span class="string">"coursera.pdf"</span>, <span class="string">"w+"</span>) <span class="keyword">as</span> my_file :</div><div class="line">        <span class="keyword">print</span> <span class="string">"下载pdf的长度"</span>, len(down_pdfs)</div><div class="line">        <span class="keyword">for</span> pdf <span class="keyword">in</span> down_pdfs :</div><div class="line">            <span class="keyword">try</span> :</div><div class="line">                my_file.write(pdf + <span class="string">"\n"</span>)</div><div class="line">            <span class="keyword">except</span> UnicodeEncodeError :</div><div class="line">                sys.exit(<span class="number">2</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">"抓取Coursera课程下载链接和pdf链接成功"</span></div></pre></td></tr></table></figure>
<p>#5. 登陆调用</p>
<p>使用<code>getpass模块中的getpass()</code>输入密码, 使用这个函数输入密码的时候不会显示任何字符, 貌似体验不好, 下次修改一下, 然后命令行传入下载课程的参数.</p>
<p>通过比较每门课下载页面, 发现之后<code>/lecture</code>前的这个字段是不同的,这样可以设置通过命令行传入这这个参数<br><a href="https://class.coursera.org/pkuco-001/lecture" target="_blank" rel="external">https://class.coursera.org/pkuco-001/lecture</a><br><a href="https://class.coursera.org/electromagnetism-001/lecture" target="_blank" rel="external">https://class.coursera.org/electromagnetism-001/lecture</a></p>
<blockquote>
<p>这里在运行命令行只需要传入<code>pkuco-001或者electromagnetism-001</code>这种字段</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span> :</span></div><div class="line">    <span class="keyword">if</span> len(sys.argv) != <span class="number">2</span> :</div><div class="line">        <span class="keyword">print</span> <span class="string">"Please Input what course you want to download.."</span></div><div class="line">        sys.exit(<span class="number">2</span>)</div><div class="line">    url = <span class="string">"https://class.coursera.org/&#123;course&#125;/lecture"</span></div><div class="line"></div><div class="line">    user_name = raw_input(<span class="string">"Input your Email &gt; "</span>)</div><div class="line">    password = getpass.getpass(<span class="string">"Input your Password &gt; "</span>)</div><div class="line">    spider = Coursera(url.format(course = sys.argv[<span class="number">1</span>]), user_name, password)</div><div class="line">    spider.start_spider()</div></pre></td></tr></table></figure>
<p>#6. 下载脚本</p>
<p>下载可以使用<code>curl</code>, Mac下安装方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install curl</div></pre></td></tr></table></figure>
<p>编写下载使用的Python脚本, 编写成功后, 修改脚本文件的文件权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod 755  downloadshell.py #最后一个参数为Python脚本名称</div></pre></td></tr></table></figure>
<p>运行下载脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$python downloadshell.py coursera.pdf #最后一个参数为连接保存文件</div></pre></td></tr></table></figure>
<p>下面是我自己编写的简单的下载脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python2</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="comment">#简单的文件下载脚本</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys, re</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span><span class="params">(file_name)</span> :</span></div><div class="line">    down_links = []</div><div class="line">    <span class="keyword">with</span> open(file_name, <span class="string">"r"</span>) <span class="keyword">as</span> my_file :</div><div class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> my_file :</div><div class="line">            down_links.append(url.replace(<span class="string">"\n"</span>, <span class="string">""</span>))</div><div class="line">    <span class="keyword">return</span> down_links</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span> :</span></div><div class="line">    <span class="keyword">if</span> len(sys.argv) != <span class="number">2</span> :</div><div class="line">        <span class="keyword">print</span> <span class="string">"Please input file name..."</span></div><div class="line">        sys.exit(<span class="number">2</span>)</div><div class="line">    down_links = read_file(sys.argv[<span class="number">1</span>])</div><div class="line">    pdf_index = <span class="number">1</span></div><div class="line">    mp4_index = <span class="number">1</span></div><div class="line">    <span class="keyword">for</span> index, link <span class="keyword">in</span> enumerate(down_links) :</div><div class="line">        <span class="keyword">if</span> link.find(<span class="string">"mp4"</span>) != <span class="number">-1</span> :</div><div class="line">            os.system(<span class="string">"curl "</span> + link + <span class="string">" -o "</span> + <span class="string">"%d.mp4"</span> % mp4_index)</div><div class="line">        <span class="keyword">elif</span> link.find(<span class="string">"pdf"</span>) != <span class="number">-1</span> :</div><div class="line">            os.system(<span class="string">"curl "</span> + link + <span class="string">" -o "</span> + <span class="string">"%d.pdf"</span> % pdf_index)</div><div class="line">            pdf_index += <span class="number">1</span></div><div class="line">        <span class="keyword">else</span> :</div><div class="line">            <span class="keyword">print</span> <span class="string">"请自行补全下载命令..."</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<p>#7.完整代码查看</p>
<p><a href="https://github.com/Andrew-liu/coursera_spider" target="_blank" rel="external">Github完整代码</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2014/12/15/Python-多线程续-Queue/" class="prev">上一篇</a><a href="/2014/12/14/Python-多线程/" class="next">下一篇</a></div><div class="copyright"><p>© 2014 - 2017 <a href="http://andrewliu.in">Andrew Liu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-58158116-2",'auto');ga('send','pageview');</script></body></html>